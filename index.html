<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Moon or Goon - Pump.fun Memecoin Casino</title>
  <style>
    body {
      background: linear-gradient(to bottom, #581c87, #000);
      color: #facc15;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      margin: 0; padding: 20px;
      text-align: center;
    }
    button, select {
      font-size: 1.2rem;
      padding: 10px 20px;
      margin: 10px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
    }
    button {
      background-color: #a16207;
      color: black;
      font-weight: bold;
    }
    #connectWalletBtn.connected {
      background-color: green;
      color: white;
    }
    #result {
      margin-top: 30px;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .balance {
      margin-top: 15px;
      font-size: 1.2rem;
    }
    label {
      font-weight: bold;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <h1>Moon or Goon</h1>
  <p>Pick your token and bet on the moon or goon!</p>

  <button id="connectWalletBtn">Connect Phantom Wallet</button>

  <div id="walletInfo" style="display:none;">
    <label for="tokenSelect">Choose your token:</label>
    <select id="tokenSelect"></select>

    <div class="balance" id="tokenBalance">Balance: 0</div>

    <button id="betMoonBtn">Bet MOON (1 token)</button>
    <button id="betGoonBtn">Bet GOON (1 token)</button>

    <div id="result"></div>
  </div>

  <script>
    // Tokens to track (example addresses on Solana)
    // You can add Pump.fun token mint addresses here
    const tokens = [
      { symbol: "SOL", mint: null, decimals: 9 }, // native SOL
      { symbol: "USDC", mint: "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v", decimals: 6 },
      { symbol: "MOONGOON", mint: "FictitiousMintAddress1234567890123456789012345", decimals: 9 },
      // Add more real tokens as needed
    ];

    const connectWalletBtn = document.getElementById('connectWalletBtn');
    const walletInfo = document.getElementById('walletInfo');
    const tokenSelect = document.getElementById('tokenSelect');
    const tokenBalanceElem = document.getElementById('tokenBalance');
    const resultElem = document.getElementById('result');
    const betMoonBtn = document.getElementById('betMoonBtn');
    const betGoonBtn = document.getElementById('betGoonBtn');

    let walletPublicKey = null;
    let selectedToken = tokens[0];

    // Check if Phantom wallet is installed
    function isPhantomInstalled() {
      return window.solana && window.solana.isPhantom;
    }

    // Connect to Phantom wallet
    async function connectWallet() {
      if (!isPhantomInstalled()) {
        alert("Phantom Wallet not found. Please install it from https://phantom.app/");
        return;
      }
      try {
        const resp = await window.solana.connect();
        walletPublicKey = resp.publicKey.toString();
        connectWalletBtn.textContent = `Connected: ${walletPublicKey.slice(0, 6)}...${walletPublicKey.slice(-4)}`;
        connectWalletBtn.classList.add('connected');
        walletInfo.style.display = "block";
        await populateTokenDropdown();
        await updateBalance();
      } catch (err) {
        console.error(err);
      }
    }

    connectWalletBtn.addEventListener('click', connectWallet);

    // Populate dropdown with tokens
    function populateTokenDropdown() {
      tokenSelect.innerHTML = '';
      tokens.forEach(token => {
        const option = document.createElement('option');
        option.value = token.mint || 'SOL'; // native SOL has null mint
        option.textContent = token.symbol;
        option.dataset.decimals = token.decimals;
        tokenSelect.appendChild(option);
      });
      selectedToken = tokens[0];
    }

    tokenSelect.addEventListener('change', async () => {
      const mint = tokenSelect.value;
      selectedToken = tokens.find(t => (t.mint || 'SOL') === mint);
      await updateBalance();
      resultElem.textContent = '';
    });

    // Update token balance
    async function updateBalance() {
      if (!walletPublicKey) return;

      if (selectedToken.mint === null) {
        // Native SOL balance
        const balanceLamports = await window.solana.getBalance();
        const solBalance = balanceLamports / 1e9;
        tokenBalanceElem.textContent = `Balance: ${solBalance.toFixed(4)} ${selectedToken.symbol}`;
      } else {
        // For SPL tokens, use RPC call to get token account balance
        // This is a simplified example using fetch to Solana RPC
        const connectionUrl = "https://api.mainnet-beta.solana.com";
        const rpcRequest = {
          "jsonrpc":"2.0",
          "id":1,
          "method":"getTokenAccountsByOwner",
          "params":[
            walletPublicKey,
            {"mint": selectedToken.mint},
            {"encoding": "jsonParsed"}
          ]
        };

        try {
          const response = await fetch(connectionUrl, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(rpcRequest)
          });
          const data = await response.json();
          const accounts = data.result.value;
          let balance = 0;
          if (accounts.length > 0) {
            balance = accounts.reduce((acc, acct) => {
              return acc + parseInt(acct.account.data.parsed.info.tokenAmount.amount);
            }, 0);
            balance = balance / (10 ** selectedToken.decimals);
          }
          tokenBalanceElem.textContent = `Balance: ${balance.toFixed(4)} ${selectedToken.symbol}`;
        } catch(e) {
          console.error(e);
          tokenBalanceElem.textContent = `Balance: 0 ${selectedToken.symbol}`;
        }
      }
    }

    // Simulate placing a bet
    function placeBet(choice) {
      resultElem.style.color = '#facc15';
      resultElem.textContent = 'Spinning...';

      setTimeout(() => {
        // 50/50 win or lose
        const win = Math.random() < 0.5;
        if (win) {
          resultElem.style.color = 'lime';
          resultElem.textContent = `You chose ${choice} and WON 2 ${selectedToken.symbol}!`;
        } else {
          resultElem.style.color = 'red';
          resultElem.textContent = `You chose ${choice} and LOST 1 ${selectedToken.symbol}! Better luck next time.`;
        }
      }, 1500);
    }

    betMoonBtn.addEventListener('click', () => placeBet('MOON'));
    betGoonBtn.addEventListener('click', () => placeBet('GOON'));
  </script>
</body>
</html>
